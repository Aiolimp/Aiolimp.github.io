<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Nuxt | Aiolimp</title><meta name="author" content="Aiolimp"><meta name="copyright" content="Aiolimp"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="nuxt初始化项目按照官网描述的 打开一个终端，并使用以下命令创建一个新的启动项目: 1pnpm dlx nuxi init &lt;project-name&gt;  进入项目终端，安装项目依赖（node版本至少v16） 1pnpm install  运行项目 1pnpm dev  目录结构理论上一个完整的项目除了常用目录以外，还需要建立 husky、commitlint、prettier、st">
<meta property="og:type" content="article">
<meta property="og:title" content="Nuxt">
<meta property="og:url" content="http://aiolimp.com/2023/07/02/nuxt3/index.html">
<meta property="og:site_name" content="Aiolimp">
<meta property="og:description" content="nuxt初始化项目按照官网描述的 打开一个终端，并使用以下命令创建一个新的启动项目: 1pnpm dlx nuxi init &lt;project-name&gt;  进入项目终端，安装项目依赖（node版本至少v16） 1pnpm install  运行项目 1pnpm dev  目录结构理论上一个完整的项目除了常用目录以外，还需要建立 husky、commitlint、prettier、st">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg">
<meta property="article:published_time" content="2023-07-01T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-12T11:51:33.214Z">
<meta property="article:author" content="Aiolimp">
<meta property="article:tag" content="Nuxt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://aiolimp.com/2023/07/02/nuxt3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nuxt',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-12 19:51:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Aiolimp" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-archive"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-folder-open"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-link"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Aiolimp"><span class="site-name">Aiolimp</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-archive"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-folder-open"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-link"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Nuxt</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-01T16:00:00.000Z" title="发表于 2023-07-02 00:00:00">2023-07-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-12T11:51:33.214Z" title="更新于 2025-04-12 19:51:33">2025-04-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Nuxt/">Nuxt</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nuxt"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="nuxt"><a href="#nuxt" class="headerlink" title="nuxt"></a>nuxt</h2><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>按照官网描述的 打开一个终端，并使用以下命令创建一个新的启动项目:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm dlx nuxi init &lt;project-name&gt;</span><br></pre></td></tr></table></figure>

<p>进入项目终端，安装项目依赖（node版本至少v16）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install</span><br></pre></td></tr></table></figure>

<p>运行项目</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm dev</span><br></pre></td></tr></table></figure>

<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>理论上一个完整的项目除了常用目录以外，还需要建立 <code>husky</code>、<code>commitlint</code>、<code>prettier</code>、<code>stylelint</code>、<code>tsconfig</code>等以便更好地规范项目。正常情况下，我们希望项目配置文件比如以上说项目规范配置文件或者是<code>build</code>工程化构建相关配置文件、环境变量等放在根目录下，而项目内容（如页面、组件等）统一放在<code>src</code>文件夹内管理。所以项目结构最终大致如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Nuxt3</span><br><span class="line">├── .husky                        # Git hooks 工具配置</span><br><span class="line">├── .vscode                       # vscode配置</span><br><span class="line">├── doc                           # 项目文档</span><br><span class="line">├── build                         # 工程化构建相关配置</span><br><span class="line">├── src</span><br><span class="line">│   ├── api                       # 接口请求服务管理</span><br><span class="line">│   │  └── modules                # 接口模块</span><br><span class="line">│   ├── assets                    # 工程化处理的静态资源</span><br><span class="line">│   ├── components                # 项目组件</span><br><span class="line">│   ├── composables               # 响应式共享状态</span><br><span class="line">│   ├── enums                     # 枚举管理</span><br><span class="line">│   ├── layouts                   # 布局组件</span><br><span class="line">│   ├── middleware                # 路由中间件</span><br><span class="line">│   ├── pages                     # 页面视图</span><br><span class="line">│   ├── plugins                   # 项目公共插件</span><br><span class="line">│   ├── public                    # 不需要工程化处理的静态资源</span><br><span class="line">│   ├── store                     # 状态管理</span><br><span class="line">│   ├── utils                     # 静态工具函数</span><br><span class="line">│   └── app.vue                   # 入口页面</span><br><span class="line">├── .commitlintrc.json            # git提交规范检查配置</span><br><span class="line">├── .editorconfig                 # 编辑器配置</span><br><span class="line">├── .env                          # 环境变量(默认/开发环境)</span><br><span class="line">├─  .env.local                    # 本地环境变量</span><br><span class="line">├── .env.pre                      # 预发布环境变量</span><br><span class="line">├── .env.prod                     # 生产环境变量</span><br><span class="line">├── .env.test                     # 测试环境变量</span><br><span class="line">├── .eslintignore                 # eslint忽略文件检查的配置</span><br><span class="line">├── .eslintrc.js                  # eslint代码规范检查配置</span><br><span class="line">├── .gitignore                    # git仓库提交忽略配置</span><br><span class="line">├── .lintstagedrc.js              # git提交代码规范检查配置</span><br><span class="line">├── .ls-lint.yml                  # 文件命名检查配置</span><br><span class="line">├── .prettierignore               # prettier忽略格式化的配置</span><br><span class="line">├── .prettierrc.js                # prettier格式化配置</span><br><span class="line">├── .stylelintignore              # 样式规范忽略检查的配置</span><br><span class="line">├── .stylelintrc.js               # 样式规范检查配置</span><br><span class="line">├── nuxt.config.ts                # Vite 构建配置入口</span><br><span class="line">├── package.json                  # 项目包管理文件</span><br><span class="line">├── pnpm-lock.yaml                # pnpm包版本管理锁定</span><br><span class="line">├── postcss.config.js             # postcss配置</span><br><span class="line">├── README.md                     # 项目说明</span><br><span class="line">├── tailwind.config.js            # tailwind配置</span><br><span class="line">└── tsconfig.json                 # TS编译的配置</span><br></pre></td></tr></table></figure>

<p>而 Nuxt 初始化，<code>app.vue</code>、<code>pages</code>文件等都建立在根目录下，所以我们先在根目录下建立 <code>src</code> 文件夹，并且把 <code>app.vue</code> 文件移入到 <code>src</code> 目录下，修改 <code>nuxt.config.ts</code>文件配置：</p>
<h3 id="nuxt-1"><a href="#nuxt-1" class="headerlink" title=".nuxt"></a>.nuxt</h3><p>Nuxt 使用.nuxt/目录在开发中生成您的Vue应用程序。</p>
<p>你不应该碰里面的任何文件，因为整个目录将在运行 nuxt dev 时重新创建。</p>
<h3 id="assets"><a href="#assets" class="headerlink" title="assets"></a>assets</h3><p>assets/ 目录用于添加构建工具(webpack或Vite)将处理的所有网站资产。</p>
<p>该目录通常包含以下类型的文件:</p>
<ul>
<li>Stylesheets (CSS, SASS, etc.)</li>
<li>Fonts</li>
<li>Images</li>
<li>Icons</li>
</ul>
<p>如果你想从服务器上提供资产，可以将文件放入 public/ 目录。</p>
<h3 id="components-组件"><a href="#components-组件" class="headerlink" title="components 组件"></a>components 组件</h3><h4 id="组件名策略"><a href="#组件名策略" class="headerlink" title="组件名策略"></a>组件名策略</h4><p>默认情况下，Nuxt自动导入components目录中的任何组件，组件名将基于它的路径、目录和文件名。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| components/</span><br><span class="line">--| Base</span><br><span class="line">----| Footer.vue</span><br></pre></td></tr></table></figure>

<p>如上，该组件名为：BaseFooter</p>
<p>如果只想根据组件的名称而不是路径自动导入组件，那么需要在 nuxt.config.ts 文件中将 <code>pathPrefix</code> 选项设置为false，此时与Nuxt2的命名策略相同：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  components: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;~/components/&#x27;</span>,</span><br><span class="line">      pathPrefix: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">| components/</span><br><span class="line"> --| Base</span><br><span class="line">----| Footer.vue</span><br></pre></td></tr></table></figure>

<p>如上，该组件名为：Footer</p>
<h4 id="绕过自动导入"><a href="#绕过自动导入" class="headerlink" title="绕过自动导入"></a>绕过自动导入</h4><ul>
<li>可以在 nuxt.config.ts 文件中在 components 下配置 path；只有 path 配置路径下的组件才会被自动导入</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">| components/</span><br><span class="line">--| business/</span><br><span class="line">----| Count.vue</span><br><span class="line">--| <span class="keyword">public</span>/</span><br><span class="line">----| MyImg.vue</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">   components: [</span><br><span class="line">      &#123;</span><br><span class="line">         path: <span class="string">&#x27;~/components/public&#x27;</span>, <span class="comment">// 默认为 &#x27;~/components&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如上只有 public 目录下的组件将被注册，且自动注册的组件名为 MyImg (非 PublicMyImg)；business 目录下的组件将被忽略。</p>
<ul>
<li>可以配置 components 为 false，此时 components 下任何组件都不会被自动导入。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">   components: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>也可以显式地从 #components 导入组件。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LazyMyImg</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="keyword">import</span> &#123; LazyMyImg &#125; <span class="keyword">from</span> <span class="string">&#x27;#components&#x27;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="惰性加载组件"><a href="#惰性加载组件" class="headerlink" title="惰性加载组件"></a>惰性加载组件</h4><p>要动态导入一个组件(也称为惰性加载组件)，则在组件名称前添加 <code>Lazy</code> 前缀。通过使用 <code>Lazy</code> 前缀，你可以延迟加载组件代码，直到合适的时刻</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MyImg</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LazyMyImg</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="composables"><a href="#composables" class="headerlink" title="composables"></a>composables</h3><p>composables 目录下的内容也将自动将 Vue 组合导入到应用中，Nuxt 只扫描 composables/ 目录的顶层文件。Composables 的主要作用是将常用逻辑和逻辑相关的代码抽象出来，以提高代码可复用性和可维护性，如：跨组件创建响应性的、对ssr友好的共享状态—— <code>useState</code>。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* composables/counter.ts 内容</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userCounter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> useState(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* 业务组件</span><br><span class="line">**&#x2F;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">  import Count from &quot;~&#x2F;components&#x2F;business&#x2F;Count.vue&quot;;</span><br><span class="line">  const counter &#x3D; userCounter();</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    业务组件内容: &#123;&#123; counter &#125;&#125;</span><br><span class="line">    &lt;a-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;counter--&quot;&gt; － &lt;&#x2F;a-button&gt;</span><br><span class="line">    &lt;a-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;counter++&quot;&gt; ＋ &lt;&#x2F;a-button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">* business&#x2F;Count 组件内容</span><br><span class="line">**&#x2F;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;Count组件内容：&#123;&#123; counter &#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;script setup lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">  const counter &#x3D; userCounter();</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="layouts"><a href="#layouts" class="headerlink" title="layouts"></a>layouts</h3><p>Nuxt提供了一个可定制的布局框架，可以在整个应用程序中使用，非常适合将常见的UI或代码模式提取到可重用的布局组件中。布局放在layouts/目录中，使用时将通过异步导入自动加载。</p>
<h4 id="默认布局"><a href="#默认布局" class="headerlink" title="默认布局"></a>默认布局</h4><p>在layouts目录下添加default.vue 布局文件。</p>
<p>不像其他组件，布局组件必须有一个根元素，以允许 Nuxt 在布局变化之间应用过渡-这个根元素不能是<slot />。如果你的应用只有一个布局，建议使用app.vue。</p>
<p>在布局文件中，布局的内容将加载在<slot />中，~/layouts/default.vue:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你使用app.vue你还需要添加 :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">NuxtLayout</span>&gt;</span></span><br><span class="line">      // 在app.vue中没有NuxtLayout组件，内容将会不显示</span><br><span class="line">   <span class="tag">&lt;/<span class="name">NuxtLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置布局"><a href="#配置布局" class="headerlink" title="配置布局"></a>配置布局</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-| layouts/</span><br><span class="line">---| default.vue</span><br><span class="line">---| custom.vue</span><br></pre></td></tr></table></figure>

<p>可以在 NuxtLayout 中添加 <code>name</code> 属性来覆盖默认布局:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">NuxtLayout</span> <span class="attr">:name</span>=<span class="string">&quot;layout&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">NuxtPage</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">NuxtLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">   <span class="comment">// 您可以根据API调用或登录状态来选择此选项</span></span></span><br><span class="line"><span class="javascript">   <span class="keyword">const</span> layout = <span class="string">&quot;custom&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以通过 <code>definePageMeta</code> 设置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">NuxtLayout</span>&gt;</span></span><br><span class="line">    巴拉巴拉小魔仙</span><br><span class="line">  <span class="tag">&lt;/<span class="name">NuxtLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line">  definePageMeta(&#123;</span><br><span class="line"><span class="javascript">    layout: <span class="string">&quot;custom&quot;</span>,</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>如果业务组件不使用 <code>&lt;NuxtLayout&gt;</code> 组件包裹，配置布局是不会生效的</strong></p>
<h3 id="middleware-中间件"><a href="#middleware-中间件" class="headerlink" title="middleware 中间件"></a>middleware 中间件</h3><p>Nuxt提供了一个可定制的路由中间件框架，可以在整个应用程序中使用，可以认为路由中间件就是导航守卫，因为它接收当前路由和下一个路由作为参数。</p>
<p>路由中间件有三种:</p>
<h4 id="匿名-或内联-路由中间件"><a href="#匿名-或内联-路由中间件" class="headerlink" title="匿名(或内联)路由中间件"></a>匿名(或内联)路由中间件</h4><p>直接在使用它们的页面中定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">   definePageMeta(&#123;</span><br><span class="line">      middleware: [</span><br><span class="line">          defineNuxtRouteMiddleware(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(<span class="string">&#x27;匿名路由中间件&#x27;</span>, to, <span class="keyword">from</span>)</span><br><span class="line">          &#125;),</span><br><span class="line">      ],</span><br><span class="line">   &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="命名路由中间件"><a href="#命名路由中间件" class="headerlink" title="命名路由中间件"></a>命名路由中间件</h4><p>放置在middleware/ 目录中，在页面上使用时会通过异步导入自动加载。(注意:路由中间件名称被规范化为串串形式，因此someMiddleware 变成 some-middleware。)</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-| middleware/</span><br><span class="line">---| auth.ts</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">   definePageMeta(&#123;</span><br><span class="line">      middleware: [<span class="string">&#x27;auth&#x27;</span>],</span><br><span class="line">   &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="全局路由中间件"><a href="#全局路由中间件" class="headerlink" title="全局路由中间件"></a>全局路由中间件</h4><p>放置在 middleware/目录中(带有<code>.global</code>后缀)，并将在每次路由更改时自动运行。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-| middleware/</span><br><span class="line">---| auth.global.ts</span><br></pre></td></tr></table></figure>

<blockquote>
<p>带 <code>.global</code> 后缀的全局路由中间件，执行顺序优先于app.vue</p>
</blockquote>
<p>Nuxt提供了两个全局可用的辅助函数，它们可以直接从中间件返回:</p>
<ul>
<li><code>navigateTo</code> 在插件或中间件中重定向到给定的路由。也可以直接调用它来执行页面导航。</li>
<li><code>abortNavigation</code> 终止导航，并显示一条可选的错误消息。</li>
</ul>
<p>不像 vue-router 中的导航守卫，第三个 next() 参数不会被传递，重定向或路由取消是通过从中间件返回值来处理的。可能的返回值有:</p>
<ul>
<li><code>nothing</code> 不会阻塞导航，并且会移动到下一个中间件功能(如果有的话)，或者完成路由导航</li>
<li><code>return navigateTo(&#39;/&#39;)</code> - 重定向到给定的路径，并将重定向代码设置为302 Found</li>
<li><code>return navigateTo(&#39;/&#39;, &#123; redirectCode: 301 &#125;)</code> - 重定向到给定的路径，并将重定向代码设置为301 Moved permanent</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">navigateTo(to: RouteLocationRaw | <span class="literal">undefined</span> | <span class="literal">null</span>,options?: NavigateToOptions) =&gt; </span><br><span class="line">    <span class="built_in">Promise</span>&lt;<span class="built_in">void</span> | NavigationFailure&gt; | RouteLocationRaw</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> NavigateToOptions &#123;</span><br><span class="line">  replace?: <span class="built_in">boolean</span></span><br><span class="line">  redirectCode?: <span class="built_in">number</span></span><br><span class="line">  external?: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Q：默认情况下，navigateTo 将给定的路由推送到客户端 Vue Router 的实例中。</p>
<p>在 middleware 调用 pinia-acitons 里面的函数，函数内执行 navigateTo(url) 会失效?</p>
<p>A：在插件、中间件、vue 文件的 setup 里面是可以调用 navigateTo 的。但是在调用 navigateTo 时，确保 <code>await</code> 或者 <code>return</code> 作为 navigateTo 的结果，否则终端就会有报错提示(如下图)，页面跳转失败。建议默认使用 await 作为 navigateTo 的结果。</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f13130c84d48445882397b51cea4762e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1994&h=262&s=329149&e=png&b=051626" alt="img"></p>
<h4 id="middleware-实现单点登录"><a href="#middleware-实现单点登录" class="headerlink" title="middleware 实现单点登录"></a>middleware 实现单点登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-| middleware&#x2F;</span><br><span class="line">---| auth.global.ts</span><br><span class="line">-| enums&#x2F;</span><br><span class="line">---| auth.ts</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* enums/auth.ts</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">export</span> <span class="built_in">enum</span> WhitePageEnum &#123;</span><br><span class="line">   BASE_HOME = <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">   SERVER_ERROR_PAGE = <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">   FETCH_TEST_PAGE = <span class="string">&#x27;fetch&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* middleware/auth.global.ts</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">import</span> &#123; WhitePageEnum &#125; <span class="keyword">from</span> <span class="string">&quot;~/enums/auth&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;~/store/modules/user&quot;</span>;</span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line"><span class="keyword">const</span> whitePathList: WhitePageEnum[] = [</span><br><span class="line">  WhitePageEnum.BASE_HOME,</span><br><span class="line">  WhitePageEnum.SERVER_ERROR_PAGE,</span><br><span class="line">  WhitePageEnum.FETCH_TEST_PAGE,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtRouteMiddleware(<span class="keyword">async</span> (to) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> userStore = useUserStore();</span><br><span class="line">  <span class="comment">// 从 store 获取用户信息</span></span><br><span class="line">  <span class="keyword">let</span> &#123; userId &#125; = userStore.getUserInfo;</span><br><span class="line">  <span class="keyword">if</span> (!userId) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> userStore.fetchUserInfo();</span><br><span class="line">    userId = res?.userId;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!whitePathList.includes(to.name <span class="keyword">as</span> WhitePageEnum)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!userId) &#123;</span><br><span class="line">      <span class="keyword">const</span> nuxtApp = useNuxtApp();</span><br><span class="line">      <span class="keyword">const</span> &#123; _route, $login &#125; = nuxtApp;</span><br><span class="line">      <span class="keyword">await</span> $login(_route?.fullPath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="pages-页面"><a href="#pages-页面" class="headerlink" title="pages 页面"></a>pages 页面</h3><p>页面目录。Nuxt 提供了一个基于文件的路由，使用 Vue Router 在底层创建路由。pages/index.vue 文件将被映射到应用程序 / 路由。</p>
<p>如果你正在使用app.vue，确保在 app.vue 使用 <code>&lt;NuxtPage/&gt;</code> 组件来显示当前页面。</p>
<h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>建立页面文件时，如果命名时将任何内容放在方括号内，它将被转换为路由参数。在文件名或目录中混合和匹配多个参数。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-| pages/</span><br><span class="line">---| index.vue</span><br><span class="line">---| users-[group]/</span><br><span class="line">-----| [id].vue</span><br></pre></td></tr></table></figure>

<p>会生成路由：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;routes&quot;</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;users-group-id&quot;</span>,</span><br><span class="line">        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/users-:group()/:id()&quot;</span>,</span><br><span class="line">        <span class="string">&quot;component&quot;</span>: <span class="string">&quot;~/pages/users-[group]/[id].vue&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据上面的例子，你可以通过 $route 对象中的 params 访问组件中的 group &amp; idx</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;text-base text-gray-600&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        获取到的 group 是 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-green-500 text-xl&quot;</span>&gt;</span>&#123;&#123; group &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        获取到的 id 是 <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-green-500 text-xl&quot;</span>&gt;</span>&#123;&#123; id &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="与-Nuxt2-区别"><a href="#与-Nuxt2-区别" class="headerlink" title="与 Nuxt2 区别"></a>与 Nuxt2 区别</h4><h5 id="文件命名规则"><a href="#文件命名规则" class="headerlink" title="文件命名规则"></a>文件命名规则</h5><p>Nuxt3 在 page 目录下，新建文件命名时，将任何内容放在方括号内，它将被转换为动态路由参数。还可以在文件名或目录中混合和匹配多个参数，甚至是非动态文本。如下路由，group 与 id 都是必选项。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-| pages/</span></span><br><span class="line"><span class="comment">---| users-[group]/</span></span><br><span class="line"><span class="comment">-----| [id].vue</span></span><br></pre></td></tr></table></figure>

<p>Nuxt2则需要创建对应的以下划线作为前缀的 Vue 文件 或 目录。如下路由，与 Nuxt3 不一样的是 id 是可选项。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-| pages/</span></span><br><span class="line"><span class="comment">---| users/</span></span><br><span class="line"><span class="comment">-----| _id.vue</span></span><br></pre></td></tr></table></figure>

<h5 id="Route-Validation"><a href="#Route-Validation" class="headerlink" title="Route Validation"></a>Route Validation</h5><p>Nuxt3通过 <code>definePageMeta</code> 中的 <code>validate</code> 属性在你想要验证的每个页面中提供路由验证。</p>
<p>validate 属性接受 route 作为参数。它返回一个布尔值，以确定这是否是要用此页呈现的有效路由。如果返回 false ，并且无法找到另一个匹配项，这将导致<code>404</code>错误。也可以直接返回一个带有 <code>statusCode/statusMessage</code>的对象，以立即响应一个错误(其他匹配不会被检查)。当 group 或者 id 为空时，页面会直接显示404错误。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">  definePageMeta(&#123;</span><br><span class="line">     validate: <span class="keyword">async</span> (route) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="regexp">/^\d+$/</span>.test(route.params.id); <span class="comment">// 判断id只能是数字</span></span><br><span class="line">     &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>nuxt2 则通过 Options API 中的 <code>validate</code> 来判断 params 的准确性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">   <span class="function"><span class="title">validate</span>(<span class="params">&#123; params &#125;</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">       <span class="keyword">const</span> &#123; group, id &#125; = params;</span></span><br><span class="line"><span class="javascript">       <span class="keyword">if</span> (!group || !id) <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript">       <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h4><p>可以使用  来显示嵌套路由。示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-| pages/</span><br><span class="line">---| parent/</span><br><span class="line">------| child.vue</span><br><span class="line">---| parent.vue</span><br></pre></td></tr></table></figure>

<p>这个文件树将生成这些路由:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/parent&#x27;</span>,</span><br><span class="line">    component: <span class="string">&#x27;~/pages/parent.vue&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;parent&#x27;</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;child&#x27;</span>,</span><br><span class="line">        component: <span class="string">&#x27;~/pages/parent/child.vue&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;parent-child&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>要显示 child.vue 组件，你必须在 pages/parent.vue 中插入 <code>&lt;NuxtPage&gt;</code> 组件:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- parent.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>I am the parent view<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NuxtPage</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- child.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-base text-gray-600&quot;</span>&gt;</span></span><br><span class="line">      I am the child view</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="页面导航"><a href="#页面导航" class="headerlink" title="页面导航"></a>页面导航</h4><p>与 vue3.js 一样，在 setup 可以使用 useRouter、useRoute 来获取路由信息。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">  <span class="keyword">const</span> route = useRoute();</span><br><span class="line">  <span class="keyword">const</span> router = useRouter();</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = route.params;</span><br><span class="line">      </span><br><span class="line">  <span class="built_in">console</span>.log(router.getRoutes());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handlerToHome = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    router.push(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>通过 router.getRoutes() 我们可以获取到当前 web 项目所有的路由，打印获取到上述动态路由的 name 和 path 如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;users-group-id&quot;</span></span><br><span class="line">   <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/users-:group()/:id()&quot;</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>我们可以跟 vue3.js 一样，在 setup 中通过 useRouter() 对象，使用 router.push / router.replace 等对路由进行导航。也可以使用 <code>&lt;NuxtLink&gt;</code> 组件，你可以将 <code>&lt;NuxtLink&gt;</code> 看成 vue 中的 <code>&lt;routerLink&gt;</code></p>
<h4 id="metaData"><a href="#metaData" class="headerlink" title="metaData"></a>metaData</h4><p>如果想在应用程序中为每个路由定义元数据，可以使用definePageMeta宏来实现这一点，它将在 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line">definePageMeta(&#123;</span><br><span class="line"><span class="javascript">  title: <span class="string">&#x27;My home page&#x27;</span></span></span><br><span class="line">&#125;)</span><br><span class="line">  </span><br><span class="line"><span class="javascript"><span class="keyword">const</span> route = useRoute()</span></span><br><span class="line"><span class="javascript"><span class="built_in">console</span>.log(route.meta.title) <span class="comment">// My home page</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="自定义路由"><a href="#自定义路由" class="headerlink" title="自定义路由"></a>自定义路由</h4><p><strong>配置~/app/router.options.ts</strong></p>
<p>在/src目录新增app文件夹，文件夹下建立router.options.ts文件（如果没有使用本文中的/src目录的配置，要在根目录下新增app文件夹）。该文件返回定制路由的函数来覆盖路由，如果返回 null 或 undefined， Nuxt将退回到默认路由。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; RouterConfig &#125; <span class="keyword">from</span> <span class="string">&quot;@nuxt/schema&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &lt;RouterConfig&gt;&#123;</span><br><span class="line">   routes: <span class="function">(<span class="params">_routes</span>) =&gt;</span> [</span><br><span class="line">      &#123;</span><br><span class="line">         name: <span class="string">&quot;home&quot;</span>,</span><br><span class="line">         path: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">         component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;~/pages/index.vue&quot;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">   ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>访问其他未定义页面路由，比如原本的 <code>/</code>，提示 <code>404</code>；原因是自定义路由完全替换了自动生成的路由。如果我们只是希望在自动导入的路由下，添加自定义路由，应该使用 <code>pages:extend</code> 钩子配置</p>
<p><strong>配置nuxt.config.ts</strong></p>
<p>使用 pages:extend 钩子配置扩展路由</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NuxtConfig &#125; <span class="keyword">from</span> <span class="string">&quot;nuxt/config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NuxtPage &#125; <span class="keyword">from</span> <span class="string">&#x27;nuxt/schema&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  hooks: &#123;</span><br><span class="line">    <span class="string">&#x27;pages:extend&#x27;</span>(pages: NuxtPage[]) &#123;</span><br><span class="line">      pages.push(&#123;</span><br><span class="line">        name: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        path: <span class="string">&#x27;/error&#x27;</span>,</span><br><span class="line">        file: <span class="string">&#x27;~/error.vue&#x27;</span>,</span><br><span class="line">        <span class="comment">// 可以传递 props 到业务组件内</span></span><br><span class="line">        props: &#123;</span><br><span class="line">          error: &#123;</span><br><span class="line">            statusCode: <span class="string">&#x27;500&#x27;</span>,</span><br><span class="line">            statusMessage: <span class="string">&#x27;服务器开小差啦，请稍后重试&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125; <span class="keyword">as</span> NuxtConfig);</span><br></pre></td></tr></table></figure>

<p>这样我们就访问 /error 路径，并且业务组件能获取到我们传递的 <code>props</code> 参数</p>
<h3 id="plugins-插件"><a href="#plugins-插件" class="headerlink" title="plugins 插件"></a>plugins 插件</h3><p>Nuxt自动读取 plugins 目录中的文件，并在创建 Vue 应用程序时加载它们。可以在文件名中使用<code>.server</code>或<code>.client</code>后缀来只在服务器端或客户端加载插件。</p>
<p>只有在plugins/目录的顶层的文件(或任何子目录中的索引文件)才会被注册为插件。</p>
<p>传递给插件的唯一参数是 nuxtApp。下面是注册 ant-design-vue 的 message 到 plugins 的示例。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">&#x27;ant-design-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;ant-design-vue/es/message/style/css&#x27;</span>; </span><br><span class="line"><span class="comment">//vite只能用 ant-design-vue/es 而非 ant-design-vue/lib</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtPlugin(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    provide: &#123;</span><br><span class="line">      message,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在 vue 文件 setup 中使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;post-id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;h-10&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;$message.info(&#x27;测试提示&#x27;)&quot;</span>&gt;</span></span><br><span class="line">        弹出 antd-message 提示</span><br><span class="line">      <span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 middleware 中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtRouteMiddleware(<span class="keyword">async</span> (to) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> nuxtApp = useNuxtApp();</span><br><span class="line">  <span class="keyword">const</span> &#123; $message &#125; = nuxtApp;</span><br><span class="line">  $message.error(<span class="string">&#x27;服务器异常，请稍后重试&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><p>public/目录直接服务于服务器根目录，包含必须保留其名称的公共文件(例如：robots.txt)或可能不会更改(例如:favicon.ico)。</p>
<h3 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h3><p>Nuxt 3 使用 utils/ 目录在整个应用程序中使用自动导入辅助函数和其他实用程序。</p>
<h3 id="app-vue"><a href="#app-vue" class="headerlink" title="app.vue"></a>app.vue</h3><p>app.vue 是应用程序的主要组件，可以在组件中定义全局的样式和行为，如路由全局守卫和错误处理等。当应用程序启动时，app.vue 会被渲染为根视图组件，并且在应用程序的整个生命周期内始终存在，可以说 app.vue 是 Nuxt.js 3 应用程序的视图层的入口文件。</p>
<h3 id="nuxt-config-ts"><a href="#nuxt-config-ts" class="headerlink" title="nuxt.config.ts"></a>nuxt.config.ts</h3><p>Nuxt 可以用一个 nuxt.config 文件轻松配置，该文件可以有js, ts or mjs扩展名。defineNuxtConfig 辅助函数是全局可用的，无需导入。nuxt.config.ts文件位于Nuxt项目的根目录下，可以覆盖或扩展应用程序的行为。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">   <span class="comment">// My Nuxt config</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="app-config-ts"><a href="#app-config-ts" class="headerlink" title="app.config.ts"></a>app.config.ts</h3><p>Nuxt 3提供了一个app.config配置文件公开应用程序中的响应性配置，能够在生命周期内的运行时更新它。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineAppConfig(&#123;</span><br><span class="line">   <span class="comment">// My App config</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h3><h4 id="useStore"><a href="#useStore" class="headerlink" title="useStore"></a>useStore</h4><p>在目录结构 composables 中，我们介绍了 useState 可组合的功能，可以跨组件创建响应性的、对ssr友好的共享状态。useState是一个ssr友好的ref替换，它的值将使用唯一的键在所有组件之间共享。</p>
<blockquote>
<p>永远不要在 <script setup> 或 setup() 函数之外定义 const state = ref()</p>
<p>这样的状态将被所有访问您的网站的用户共享，并可能导致内存泄漏!</p>
<p>用 const useX = () =&gt; useState(‘x’) 代替</p>
</blockquote>
<h3 id="引入pinia"><a href="#引入pinia" class="headerlink" title="引入pinia"></a>引入pinia</h3><p>终端安装 @pinia/nuxt</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="keyword">add</span> <span class="variable">@pinia</span><span class="operator">/</span>nuxt</span><br></pre></td></tr></table></figure>

<p>需要在 nuxt.config.ts 上配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NuxtConfig &#125; <span class="keyword">from</span> <span class="string">&quot;nuxt/config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  modules: [<span class="string">&quot;@pinia/nuxt&quot;</span>],</span><br><span class="line">&#125; <span class="keyword">as</span> NuxtConfig);</span><br></pre></td></tr></table></figure>

<p>创建 store 目录，并在目录下创建状态管理模块，如下是用户登录信息的示例：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; selectByUserIdBySlient &#125; <span class="keyword">from</span> <span class="string">&quot;~/api/modules/system/user&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FecthUserInfoResp &#125; <span class="keyword">from</span> <span class="string">&quot;~/api/modules/system/model/UserType&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = defineStore(<span class="string">&quot;user&quot;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    userInfo: &#123;&#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  getters: &#123;</span><br><span class="line">    getUserInfo(): FecthUserInfoResp &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.userInfo || &#123;&#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> fetchUserInfo(): <span class="built_in">Promise</span>&lt;FecthUserInfoResp&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> selectByUserIdBySlient();</span><br><span class="line">      <span class="keyword">if</span> ((res <span class="keyword">as</span> FecthUserInfoResp)?.userId) &#123;</span><br><span class="line">        <span class="built_in">this</span>.userInfo = res;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userInfo = &#123;&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123; ...this.userInfo &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在项目中，我们可以这样使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;~/store/modules/user&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取用户信息</span></span><br><span class="line"><span class="keyword">const</span> userStore = useUserStore();</span><br><span class="line"><span class="keyword">let</span> &#123; userId &#125; = userStore.getUserInfo;</span><br><span class="line"><span class="keyword">if</span> (!userId) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> userStore.fetchUserInfo();</span><br><span class="line">  userId = res?.userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(userId ? <span class="string">&quot;用户已登录&quot;</span> : <span class="string">&quot;用户未登录&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>Nuxt 3是一个全栈框架，这意味着在不同的上下文中，有几种不可避免的用户运行时错误来源:</p>
<ul>
<li>Vue渲染生命周期中的错误(SSR + SPA)</li>
<li>API或Nitro服务器生命周期中的错误</li>
<li>服务器和客户端启动错误(SSR + SPA)</li>
<li>下载JS块时出错</li>
</ul>
<h3 id="渲染一个Error页面"><a href="#渲染一个Error页面" class="headerlink" title="渲染一个Error页面"></a>渲染一个Error页面</h3><p>当Nuxt遇到致命错误时，无论是在服务器生命周期中，还是在呈现您的Vue应用程序(SSR和SPA)时，它都会呈现一个JSON响应(如果请求带有Accept: application/json标头)或一个HTML错误页面。我们可以通过在应用程序的源目录中app.vue旁边添加~/error.vue来自定义这个错误页面。这个页面有一个单一的prop—— error，它包含一个错误信息。具体可以参考以下自定义 error.vue 内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  &lt;a-result</span><br><span class="line">    status=&quot;error&quot;</span><br><span class="line">    :title=&quot;error.statusCode&quot;</span><br><span class="line">    :sub-title=&quot;error.message || error.statusMessage || &#x27;服务器发生错误，请联系管理员&#x27;&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">extra</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">key</span>=<span class="string">&quot;console&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Go Console<span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">key</span>=<span class="string">&quot;buy&quot;</span>&gt;</span>Buy Again<span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;error.stack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">a-result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; CloseCircleOutlined &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons-vue&#x27;</span>;</span></span><br><span class="line">  </span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> props = defineProps(&#123;</span></span><br><span class="line"><span class="javascript">    error: <span class="built_in">Object</span>,</span></span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; error &#125; = toRefs(props);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-class">.desc</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-bottom</span>: <span class="number">1em</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Error-辅助函数"><a href="#Error-辅助函数" class="headerlink" title="Error 辅助函数"></a>Error 辅助函数</h3><table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
<th>使用方式</th>
</tr>
</thead>
<tbody><tr>
<td>createError</td>
<td>如果你抛出一个用 createError 创建的错误: 在服务器端，它将触发一个全屏错误页面，你可以用 clearError 清除。  在客户端，它会抛出一个非致命的错误让你处理。如果你需要触发一个全屏错误页面，那么你可以通过设置 fatal: true 来实现。</td>
<td>function createError (err: { cause, data, message, name, stack, statusCode, statusMessage, fatal }): Error</td>
</tr>
<tr>
<td>showError</td>
<td>在客户端的任何地方调用这个函数，或者(在服务器端)直接在中间件、插件或setup()函数中调用，都将触发一个全屏错误页面，可以用clearError清除。</td>
<td>function showError (err: string | Error | { statusCode, statusMessage }): Error</td>
</tr>
<tr>
<td>clearError</td>
<td>这个函数将清除当前处理的Nuxt错误。它还有一个可选的重定向路径(例如，如果你想导航到一个“安全”的页面)。</td>
<td>function clearError (options?: { redirect?: string }): Promise</td>
</tr>
</tbody></table>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>Nuxt CLI在开发模式下以及运行 nuxi build 和 nuxi generate 时内置了 dotenv 支持。</p>
<p>除了任何进程环境变量外，如果您的项目根目录中有一个.env文件，它将在构建、开发和生成时自动加载，并且在 nuxt.config 文件和模块中设置的任何环境变量都将可访问。</p>
<p>如果您想使用不同的文件 - 例如，使用 .env.local 或 .env.prod - 我们可以在使用 nuxi 时传递–dotenv 标志来实现。例如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx nuxi dev --dotenv <span class="selector-class">.env</span><span class="selector-class">.local</span></span><br></pre></td></tr></table></figure>

<p>在开发模式下更新 .env 文件时，Nuxt 实例会自动重新启动以将新值应用于 process.env。</p>
<p>runtimeConfig API 向应用程序的其余部分公开了诸如环境变量之类的值。默认情况下，这些键只在服务器端可用。runtimeConfig.public 中的键也可以在客户端使用。这些值应该在 nuxt.config 中定义，并且可以使用环境变量重写。我们还可以在 app.config 定义公开变量。二者区别是：</p>
<ul>
<li>runtimeConfig：需要在使用环境变量构建后指定的私有或公共令牌。</li>
<li>app.config：在构建时确定的公共令牌，网站配置，如主题变量，标题和任何不敏感的项目配置。</li>
</ul>
<p>.env 文件配置：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># api Url</span><br><span class="line">NUXT_PUBLIC_API_BASE_URL = &#x27;https://magiccube-gateway.3weijia.com&#x27;</span><br><span class="line"></span><br><span class="line"># oss Login Url</span><br><span class="line">NUXT_PUBLIC_LOGIN_URL = &#x27;https://passport-dev.3weijia.com&#x27;</span><br><span class="line"></span><br><span class="line"># Basic Url</span><br><span class="line">NUXT_PUBLIC_LOCATION_ORIGIN_URL = &#x27;https://mall-dev.3weijia.com&#x27;</span><br></pre></td></tr></table></figure>

<p>nuxt.config.ts 配置：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NuxtConfig &#125; <span class="keyword">from</span> <span class="string">&quot;nuxt/config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  runtimeConfig: &#123;</span><br><span class="line">     <span class="keyword">public</span>: &#123;</span><br><span class="line">        apiBaseUrl: process.env.NUXT_PUBLIC_API_BASE_URL,</span><br><span class="line">        loginUrl: process.env.NUXT_PUBLIC_LOGIN_URL,</span><br><span class="line">        locationOriginUrl: process.env.NUXT_PUBLIC_LOCATION_ORIGIN_URL,</span><br><span class="line">     &#125;,</span><br><span class="line">   &#125;</span><br><span class="line">&#125; <span class="keyword">as</span> NuxtConfig);</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> runtimeConfig = useRuntimeConfig();</span><br><span class="line"><span class="keyword">const</span> &#123; loginUrl, locationOriginUrl &#125; = runtimeConfig.public;</span><br></pre></td></tr></table></figure>

<h2 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h2><p>Nuxt提供了 useFetch, useLazyFetch, useAsyncData 和 useLazyAsyncData 来处理应用程序中的数据获取。</p>
<h3 id="useAsyncData"><a href="#useAsyncData" class="headerlink" title="useAsyncData"></a>useAsyncData</h3><p>在页面、组件和插件中，我们可以使用useAsyncData来访问异步解析的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;NuxtLayout&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;fetch&quot;&gt;</span><br><span class="line">      &lt;a-select</span><br><span class="line">        v-model:value&#x3D;&quot;value&quot;</span><br><span class="line">        :options&#x3D;&quot;options&quot;</span><br><span class="line">        style&#x3D;&quot;width: 200px&quot;</span><br><span class="line">        label-in-value</span><br><span class="line">        @change&#x3D;&quot;handleChange&quot;</span><br><span class="line">      &gt;&lt;&#x2F;a-select&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;NuxtLayout&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">const &#123; data: options &#125; &#x3D; await useAsyncData(</span><br><span class="line">  &quot;mountains&quot;,</span><br><span class="line">  () &#x3D;&gt; $fetch(&quot;https:&#x2F;&#x2F;yapi.3weijia.com&#x2F;mock&#x2F;1357&#x2F;api&#x2F;geography&quot;),</span><br><span class="line">  &#123;</span><br><span class="line">    pick: [&quot;data&quot;],</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const value &#x3D; ref&lt;Value&gt;();</span><br><span class="line">const handleChange &#x3D; (value: Value) &#x3D;&gt; &#123;</span><br><span class="line">  console.log(value);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="useLazyAsyncData"><a href="#useLazyAsyncData" class="headerlink" title="useLazyAsyncData"></a>useLazyAsyncData</h3><p>默认情况下，useAsyncData 阻塞导航，直到它的 async 处理程序被解析。useLazyAsyncData 为 useAsyncData 提供了一个包装器，通过将 lazy 选项设置为 true，在处理程序解析之前触发导航。</p>
<h3 id="useFetch"><a href="#useFetch" class="headerlink" title="useFetch"></a>useFetch</h3><p>这个对象为 useAsyncData 和 $fetch提供了一个方便的包装。</p>
<p>它根据URL和获取选项自动生成一个键，根据服务器路由为请求URL提供类型提示，并推断API响应类型。</p>
<h3 id="useLazyFetch"><a href="#useLazyFetch" class="headerlink" title="useLazyFetch"></a>useLazyFetch</h3><p>这个可组合的行为与带有 lazy: true 选项集的 useFetch 相同。</p>
<p>由上可得以下关系：</p>
<table>
<thead>
<tr>
<th></th>
<th>useLazyFetch</th>
<th>useAsyncData</th>
<th>useLazyAsyncData</th>
</tr>
</thead>
<tbody><tr>
<td>与 useFetch 的关系</td>
<td>lazy 设为 true 的 useFetch</td>
<td>useFetch 是 useAsyncData 与 $fetch 的语法糖</td>
<td>useFetch 是 useAsyncData 与 $fetch 的语法糖，useLazyAsyncData 是 lazy 设为 true 的 useAsyncData</td>
</tr>
</tbody></table>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p><strong>引入less</strong></p>
<p>在项目中断执行安装 less</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm <span class="keyword">add</span> less <span class="comment">--save</span></span><br></pre></td></tr></table></figure>

<p>在assets目录下创建less全局变量文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-| assets&#x2F;</span><br><span class="line">---| styles&#x2F;</span><br><span class="line">------| index.less</span><br></pre></td></tr></table></figure>

<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// ~/assets/styles/index.less 内容</span><br><span class="line">@theme-color: #147ffa;</span><br></pre></td></tr></table></figure>

<p>使用 vite 打包的话，需要在 nuxt.config.ts 上配置</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NuxtConfig &#125; <span class="keyword">from</span> <span class="string">&quot;nuxt/config&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  vite: &#123;</span><br><span class="line">    css: &#123;</span><br><span class="line">      preprocessorOptions: &#123;</span><br><span class="line">        less: &#123;</span><br><span class="line">          additionalData: <span class="string">&#x27;@import &quot;@/assets/styles/index.less&quot;;&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125; <span class="keyword">as</span> NuxtConfig);</span><br></pre></td></tr></table></figure>

<p>使用方式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;less&quot;</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">.home &#123;</span><br><span class="line">  .blue &#123;</span><br><span class="line"><span class="css">    <span class="attribute">color</span>: @theme-color;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="遇到的问题与解决方案"><a href="#遇到的问题与解决方案" class="headerlink" title="遇到的问题与解决方案"></a>遇到的问题与解决方案</h2><h3 id="useFetch-在-onMounted-执行返回值为-null？"><a href="#useFetch-在-onMounted-执行返回值为-null？" class="headerlink" title="useFetch() 在 onMounted 执行返回值为 null？"></a>useFetch() 在 onMounted 执行返回值为 null？</h3><ul>
<li>场景一</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">html</span><br><span class="line"></span><br><span class="line"> 代码解读</span><br><span class="line">复制代码<span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; testData &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;testFetch1&quot;</span>&gt;</span>取消订单<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testData = ref();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> id = ref(<span class="string">&#x27;wx9d982ed41aa8b75a&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testFetch1 = <span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">    useFetch(<span class="string">`https://paas-fe-dev.3weijia.com/helper/server/wechat/mp/app/<span class="subst">$&#123;id.value&#125;</span>`</span>, &#123;</span></span><br><span class="line"><span class="javascript">      key: <span class="string">&#x27;myfetch&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line">      testData.value = res.data.value;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;testData.value&#x27;</span>, process.server, testData.value);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  onMounted(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&#x27;onMounted&#x27;</span>);</span></span><br><span class="line">    testFetch1(); </span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们可以通过 console.log 发现，刷新页面后，客户端执行了 testFetch1 中的 useFetch，但是返回结果为 null；而服务端没有打印日志，得出结论<strong>服务端不执行 onMounted 内容</strong>。</p>
<p>当我们从其他页面通过 router.push/replace 进入这个页面时，即客户端渲染时，发现接口拥有返回数据，渲染正常。</p>
<p>当我们在 onMounted 中添加 await nextTick()；发现接口拥有返回数据，渲染正常。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     onMounted(async () =&gt; &#123;</span><br><span class="line">        console.log(&#x27;onMounted&#x27;);</span><br><span class="line"><span class="addition">++      await nextTick();</span></span><br><span class="line">        testFetch1();</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>场景二</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">html</span><br><span class="line"></span><br><span class="line"> 代码解读</span><br><span class="line">复制代码<span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123; testData &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">van-button</span> <span class="attr">type</span>=<span class="string">&quot;default&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;testFetch1&quot;</span>&gt;</span>取消订单<span class="tag">&lt;/<span class="name">van-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testData = ref();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> id = ref(<span class="string">&#x27;wx9d982ed41aa8b75a&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testFetch1 = <span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">    useFetch(<span class="string">`https://paas-fe-dev.3weijia.com/helper/server/wechat/mp/app/<span class="subst">$&#123;id.value&#125;</span>`</span>, &#123;</span></span><br><span class="line"><span class="javascript">      key: <span class="string">&#x27;myfetch&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span></span><br><span class="line">      testData.value = res.data.value;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;testData.value&#x27;</span>, process.server, testData.value);</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  testFetch1();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接在 setup 执行 useFetch，虽然页面渲染正常，接口请求正常，但是控制台有报错信息：Hydration completed but contains mismatches. ，表明服务端和客户端渲染 testData 内容不一致，如图：</p>
<p>终端拥有打印信息：</p>
<p>说明服务端、客户端都执行了 useFetch，且返回结果一致，需要解决这个报错内容有两种解决方式：</p>
<ol>
<li>使用标签将  包裹起来</li>
</ol>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;test&quot;&gt;</span><br><span class="line"><span class="addition">++    &lt;div&gt;</span></span><br><span class="line">        &#123;&#123; testData &#125;&#125;</span><br><span class="line"><span class="addition">++    &lt;/div&gt;</span></span><br><span class="line">      &lt;van-button type=&quot;default&quot; @click=&quot;testFetch1&quot;&gt;取消订单&lt;/van-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>但是这可能不太符合我们的预期，因为我们并不会对每个这种渲染对象都使用唯一标签包裹，那太麻烦了。</p>
<ol>
<li>将 testFetch1 改造一下，等待 testFetch2 执行完毕后再进行渲染</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testData = ref();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> id = ref(<span class="string">&#x27;wx9d982ed41aa8b75a&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> testFetch2 = <span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> useFetch(<span class="string">`https://paas-fe-dev.3weijia.com/helper/server/wechat/mp/app/<span class="subst">$&#123;id.value&#125;</span>`</span>);</span></span><br><span class="line">    testData.value = data.value;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="javascript">  <span class="keyword">await</span> testFetch2();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务端不执行onMounted内容；<br>如果onMounted内需执行useFetch，应该放在await nextTick之后，否则会返回null；<br>在setup内(onMounted外)执行useFetch，服务端和客户端都执行，为了避免渲染时useFetch未执行完毕，尽量使用await而不是then方法；</p>
</blockquote>
<p>后面在官方文档翻到这句话，可能就是客户端在没有激活之前，放在onMounted的useFetch返回null的原因吧 <img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a52be1663704e2dadbba187c5b0e869~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1596&h=236&s=118436&e=png&b=fdf4e8" alt="image.png"></p>
<h3 id="composables定义了某变量并赋值，浏览器刷新后服务端获取该变量还是旧值？"><a href="#composables定义了某变量并赋值，浏览器刷新后服务端获取该变量还是旧值？" class="headerlink" title="composables定义了某变量并赋值，浏览器刷新后服务端获取该变量还是旧值？"></a>composables定义了某变量并赋值，浏览器刷新后服务端获取该变量还是旧值？</h3><ul>
<li>场景<br>我们在composables文件夹下新建文件useTest.ts，里面包含一个变量tcc与useTest组合方法，useTest获取某cookie值保存到tcc变量中，原本设想是，改变量若是有值，就不再重新获取的。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tcc: <span class="built_in">string</span> | <span class="literal">null</span> | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTest = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!tcc) &#123;</span><br><span class="line">    <span class="keyword">const</span> tccRef = useCookie(<span class="string">&#x27;tcc&#x27;</span>);</span><br><span class="line">    tcc = tccRef.value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tcc;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在vue文件的setup执行该方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(<span class="string">&#x27;useTest()&#x27;</span>, useTest());</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>浏览器cookie添加tcc参数值为「PC_MALL」，刷新浏览器后，发现客户端与服务端都打印了useTest()值为「PC_MALL」</p>
<p>然后我们修改浏览器cookie中tcc参数值为「H5_MALL」，刷新浏览器发现客户端打印了新的cookie值，但是服务端还是旧值</p>
<p>这感觉看上去像是composables下定义的组合文件内容在服务端只执行一次，不知道nuxt这样设计的原因，只能要求开发的时候注意啦~</p>
<blockquote>
<p>在组合中尽量不定义变量保存客户端信息（如cookie、storage等）</p>
</blockquote>
<h3 id="某些DOM节点渲染了两遍"><a href="#某些DOM节点渲染了两遍" class="headerlink" title="某些DOM节点渲染了两遍"></a>某些DOM节点渲染了两遍</h3><ul>
<li>场景</li>
</ul>
<p>打包之后，在APP内预览发现页面异常，有些DOM节点渲染了两遍。其中第一次渲染的DOM不能点击，第二次渲染的DOM可以点击。</p>
<p>经过多番测试，发现是我在setup初始化写了路由的重定向。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">await</span> router.replace(&#123;</span></span><br><span class="line"><span class="javascript">  name: <span class="string">&#x27;index&#x27;</span>,</span></span><br><span class="line">  query: &#123;</span><br><span class="line">    floor: activeFloorId.value,</span><br><span class="line">    spu: activeSpuId.value,</span><br><span class="line">    sku: activeSkuId.value,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我把 router.replace 放在 onMounted 里面执行依旧会出现此问题</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">onMounted(<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">await</span> router.replace(&#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;index&#x27;</span>,</span></span><br><span class="line">    query: &#123;</span><br><span class="line">      floor: activeFloorId.value,</span><br><span class="line">      spu: activeSpuId.value,</span><br><span class="line">      sku: activeSkuId.value,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是在onMounted添加nextTick之后，显示正常</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">    onMounted(async () =&gt; &#123;</span><br><span class="line"><span class="addition">++    await nextTick();</span></span><br><span class="line">      await router.replace(&#123;</span><br><span class="line">        name: &#x27;index&#x27;,</span><br><span class="line">        query: &#123;</span><br><span class="line">          floor: activeFloorId.value,</span><br><span class="line">          spu: activeSpuId.value,</span><br><span class="line">          sku: activeSkuId.value,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>查阅资料后初步判定是ssr引起的。为了部分DOM能ssr渲染，又能在客户端保留vdom的优势，vue的做法是在ssr生成的html的基础上，再同时生成一个js文件。<br> js文件里同时保存在客户端能再现渲染的js版本，js版本里是通过vdom进行渲染的操作函数，而html是ssr后的结果。<br> 当浏览器拿到这两个东西之后，就开始重新执行一遍vdom的生成过程，并在此基础上去执行客户端动态操作。那一旦出现不匹配的情况，那dom渲染就会出问题，部分界面组件会重复渲染。<br> 所以初始化的时候我们可以认为第一次渲染的DOM节点是服务端的首屏的静态HTML，点击无效。第二次渲染的DOM节点是属于客户端渲染的结果。</p>
<h3 id="如何设置页面客户端渲染"><a href="#如何设置页面客户端渲染" class="headerlink" title="如何设置页面客户端渲染"></a>如何设置页面客户端渲染</h3><p>这个问题是在评论中发现的，就一起记录了。</p>
<ul>
<li>场景一：关闭项目所有页面的ssr 对于不需要索引或用户经常访问的高度交互式web应用程序，可以在nuxt.config.ts中使用Nuxt启用仅客户端渲染：</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123; <span class="attr">ssr</span>: <span class="literal">false</span> &#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>场景二：仅对个别页面关闭ssr</p>
<p>使用路由规则：从Nuxt 3开始随着公测rc. 12 版本发布，支持路由规则和混合渲染。使用路由规则，您可以为一组nuxt路由定义规则，改变呈现模式或分配基于路由的缓存策略。</p>
<ul>
<li><code>redirect</code> - 重定向。</li>
<li><code>ssr</code> - 禁用应用程序部分的服务器端渲染，并使用<code>ssr: false</code>使它们仅用于spa。</li>
<li><code>cors</code> - 自动添加带有<code>cors: true</code>的cors报头-你可以通过用<code>headers</code>覆盖自定义输出</li>
<li><code>headers</code> - 为站点的各个部分添加特定的标题</li>
<li><code>static</code> and <code>swr</code> - <code>static</code>支持单个(按需)构建;<code>swr</code>启用静态构建，该构建持续一个可配置的TTL。<br><strong>配置ssr示例:</strong></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineNuxtConfig(&#123;</span><br><span class="line">  routeRules: &#123;</span><br><span class="line">    <span class="string">&#x27;/admin/**&#x27;</span>: &#123; <span class="attr">ssr</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>如果确实使用<code>ssr:false</code>，还应该在/src目录新增app文件夹，文件夹下建立spa-loading-template.html文件（如果没有使用本文中的/src目录的配置，要在根目录下新增app文件夹），html文件中包含一些我们想用来渲染加载页面的HTML。</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Aiolimp.com">Aiolimp</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://aiolimp.com/2023/07/02/nuxt3/">http://aiolimp.com/2023/07/02/nuxt3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Aiolimp.com" target="_blank">Aiolimp</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Nuxt/">Nuxt</a></div><div class="post_share"><div class="social-share" data-image="https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/08/TypeScript/" title="TypeScript"><img class="cover" src="https://static001.geekbang.org/resource/image/4b/8b/4b2db13a5c87e4438146baa0cf0c688b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">TypeScript</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/05/JS%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="JavaScript数据类型"><img class="cover" src="https://static001.geekbang.org/resource/image/13/6b/13daccec5e12c89ea63e8c51dd20cb6b.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JavaScript数据类型</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Aiolimp</div><div class="author-info__description">生如长河,渡船千艘</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">84</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Aiolimp" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#nuxt"><span class="toc-number">1.</span> <span class="toc-text">nuxt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">初始化项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">目录结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nuxt-1"><span class="toc-number">3.1.</span> <span class="toc-text">.nuxt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#assets"><span class="toc-number">3.2.</span> <span class="toc-text">assets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#components-%E7%BB%84%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">components 组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%90%8D%E7%AD%96%E7%95%A5"><span class="toc-number">3.3.1.</span> <span class="toc-text">组件名策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E8%87%AA%E5%8A%A8%E5%AF%BC%E5%85%A5"><span class="toc-number">3.3.2.</span> <span class="toc-text">绕过自动导入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%83%B0%E6%80%A7%E5%8A%A0%E8%BD%BD%E7%BB%84%E4%BB%B6"><span class="toc-number">3.3.3.</span> <span class="toc-text">惰性加载组件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#composables"><span class="toc-number">3.4.</span> <span class="toc-text">composables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layouts"><span class="toc-number">3.5.</span> <span class="toc-text">layouts</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%B8%83%E5%B1%80"><span class="toc-number">3.5.1.</span> <span class="toc-text">默认布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%B8%83%E5%B1%80"><span class="toc-number">3.5.2.</span> <span class="toc-text">配置布局</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#middleware-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">middleware 中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D-%E6%88%96%E5%86%85%E8%81%94-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">3.6.1.</span> <span class="toc-text">匿名(或内联)路由中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">3.6.2.</span> <span class="toc-text">命名路由中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">3.6.3.</span> <span class="toc-text">全局路由中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#middleware-%E5%AE%9E%E7%8E%B0%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"><span class="toc-number">3.6.4.</span> <span class="toc-text">middleware 实现单点登录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pages-%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.7.</span> <span class="toc-text">pages 页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">3.7.1.</span> <span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E-Nuxt2-%E5%8C%BA%E5%88%AB"><span class="toc-number">3.7.2.</span> <span class="toc-text">与 Nuxt2 区别</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">文件命名规则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Route-Validation"><span class="toc-number">3.7.2.2.</span> <span class="toc-text">Route Validation</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"><span class="toc-number">3.7.3.</span> <span class="toc-text">嵌套路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA"><span class="toc-number">3.7.4.</span> <span class="toc-text">页面导航</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#metaData"><span class="toc-number">3.7.5.</span> <span class="toc-text">metaData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"><span class="toc-number">3.7.6.</span> <span class="toc-text">自定义路由</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plugins-%E6%8F%92%E4%BB%B6"><span class="toc-number">3.8.</span> <span class="toc-text">plugins 插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#public"><span class="toc-number">3.9.</span> <span class="toc-text">public</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#utils"><span class="toc-number">3.10.</span> <span class="toc-text">utils</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-vue"><span class="toc-number">3.11.</span> <span class="toc-text">app.vue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nuxt-config-ts"><span class="toc-number">3.12.</span> <span class="toc-text">nuxt.config.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-config-ts"><span class="toc-number">3.13.</span> <span class="toc-text">app.config.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">3.14.</span> <span class="toc-text">状态管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#useStore"><span class="toc-number">3.14.1.</span> <span class="toc-text">useStore</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/03/Fabric/" title="Fabric.js"><img src="https://static001.geekbang.org/resource/image/ee/70/ee7627bac9defb7621c2489fbacb3a70.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Fabric.js"/></a><div class="content"><a class="title" href="/2024/08/03/Fabric/" title="Fabric.js">Fabric.js</a><time datetime="2024-08-03T08:57:49.000Z" title="发表于 2024-08-03 16:57:49">2024-08-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/02/MySql/" title="MySql"><img src="https://static001.geekbang.org/resource/image/1b/21/1b809d9a2bdf3ecc481322d7c9223c21.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySql"/></a><div class="content"><a class="title" href="/2024/06/02/MySql/" title="MySql">MySql</a><time datetime="2024-06-01T16:00:00.000Z" title="发表于 2024-06-02 00:00:00">2024-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/13/WebWork/" title="Web Worker 基本使用"><img src="https://static001.geekbang.org/resource/image/fb/c0/fb4e210a483a7892433331082f5f09c0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Web Worker 基本使用"/></a><div class="content"><a class="title" href="/2024/04/13/WebWork/" title="Web Worker 基本使用">Web Worker 基本使用</a><time datetime="2024-04-12T16:00:00.000Z" title="发表于 2024-04-13 00:00:00">2024-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/11/node/" title="node基础"><img src="https://static001.geekbang.org/resource/image/bd/2e/bddfad3dc8fb2f7c4942a0dc1286c92e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="node基础"/></a><div class="content"><a class="title" href="/2024/03/11/node/" title="node基础">node基础</a><time datetime="2024-03-10T16:00:00.000Z" title="发表于 2024-03-11 00:00:00">2024-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/12/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="代理模式"><img src="https://static001.geekbang.org/resource/image/bd/2e/bddfad3dc8fb2f7c4942a0dc1286c92e.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="代理模式"/></a><div class="content"><a class="title" href="/2023/08/12/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="代理模式">代理模式</a><time datetime="2023-08-12T08:57:49.000Z" title="发表于 2023-08-12 16:57:49">2023-08-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Aiolimp</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>